.setup_node: &setup_node
  - apt-get install -y curl
  - curl -fsSL https://deb.nodesource.com/setup_20.x -o nodesource_setup.sh
  - bash nodesource_setup.sh
  - apt-get install -y nodejs
  - npm install --global yarn
  - echo 'yarn-offline-mirror ".yarn-cache/"' >> .yarnrc
  - echo 'yarn-offline-mirror-pruning true' >> .yarnrc

.ruby_deps: &ruby_deps
  - bundle config set --local path 'vendor/ruby'
  - bundle install -j $(nproc)

.node_deps: &node_deps
  - *setup_node
  - PUPPETEER_SKIP_DOWNLOAD=true yarn install --frozen-lockfile --no-progress --ignore-engines

.node_deps_puppet: &node_deps_puppet
  - *setup_node
  - yarn install --frozen-lockfile --no-progress --ignore-engines

.setup_langs:
  script:
    - *ruby_deps
    - *node_deps

# Only used by Pa11y for now
.setup_langs_with_puppet:
  script:
    - *ruby_deps
    - *node_deps_puppet
