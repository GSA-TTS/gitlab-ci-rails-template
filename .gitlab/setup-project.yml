include:
  - local: ".gitlab/caches.yml"
  - local: ".gitlab/setup-langs.yml"

.setup-project:
  services:
    - name: postgres:15
      alias: pg
  before_script:
    - !reference [.setup_langs, script]
    # This has to come late because we need CI_SERVICE_pg defined
    - export DATABASE_URL="postgres://postgres:${POSTGRES_PASSWORD}@${CI_SERVICE_pg}:5432/rtci_test"
    - bin/rails db:create
    - bundle exec rake assets:precompile
    - bundle exec rake db:schema:load

.init-build-project:
  cache:
    - !reference [.cache_ruby]
    - !reference [.cache_yarn]
    - !reference [.cache_assets_pull_push]
  extends: .setup_project
